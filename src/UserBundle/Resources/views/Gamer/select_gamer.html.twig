{# src/UserBundle/Resources/views/Gamer/select_gamer.html.twig #}

{% extends "GameBundle::layout.html.twig" %}
{% set select_gamer = true %}

{% block title %}{{ parent() }} - {{ titleTab }}{% endblock %}

{% block body %}
    {% for message in app.session.flashbag.get('notice') %}
      <div class="alert alert-danger">
        <p>{{ message }}</p>
      </div>
    {% endfor %}

    {% for message in app.session.flashbag.get('success') %}
      <div class="alert alert-success">
        <p>{{ message }}</p>
      </div>
    {% endfor %}

    <div class="row selectGamer">
      <div class="col-lg-offset-3 col-lg-3 col-sm-offset-1 col-sm-5 center">    
        <h3>{{ title1 }}</h3>
        {% if gamers %}
          <div class="gamer">
            {% for gamer in gamers %}
                <form action=" {{ path('play') }} " method="GET">
                <p><label><input type="checkbox" name="gamer[]" value="{{ gamer.id }}" /> {{ gamer.username }}</label></p>
            {% endfor %}
          </div>
          <div>
            <a class="checkAllGamers btn btn-default">Cocher tous les joueurs</a>
          </div>
      </div>

      <div class="col-lg-3 col-sm-5 center">
        <h3>{{ title2 }}</h3>
        <div class="chooseSubject">
          {% for subject in subjects %}
              <p><label><input type="checkbox" name="subject[]" value="{{ subject.id }}" /> {{ subject.nameSubject }}</label><br/></p>
          {% endfor %}
        </div>
        <div>
          <a class="checkAllSubjects btn btn-default">Cocher les 4 premiers thèmes</a>
        </div>
        {% if subjects|length < 4 %}
          <div><span class="glyphicon glyphicon-time"> Patience, il n'y a pas encore assez de questions pour certains thèmes.</span></div>
        {% endif %}

      </div>
    </div>
      
      {% for schoolLevel in schoolLevels %}
        {% if schoolLevel.schoolClass == 'CP' and schoolLevel.questions|length <= 3 %}
          <p>Attention, il y a seulement {{ schoolLevel.questions|length }} questions de niveau CP.</p>
        {% endif %}
        {% if schoolLevel.schoolClass == 'CE1' and schoolLevel.questions|length <= 3 %}
          <p>Attention, il y a seulement {{ schoolLevel.questions|length }} questions de niveau CE1.</p>
        {% endif %}
        {% if schoolLevel.schoolClass == 'CE2' and schoolLevel.questions|length <= 3 %}
          <p>Attention, il y a seulement {{ schoolLevel.questions|length }} questions de niveau CE2.</p>
        {% endif %}
        {% if schoolLevel.schoolClass == 'CM1' and schoolLevel.questions|length <= 3 %}
          <p>Attention, il y a seulement {{ schoolLevel.questions|length }} questions de niveau CM1.</p>
        {% endif %}
        {% if schoolLevel.schoolClass == 'CM2' and schoolLevel.questions|length <= 3 %}
          <p>Attention, il y a seulement {{ schoolLevel.questions|length }} questions de niveau CM2.</p>
        {% endif %}
      {% endfor %}
      
    <div>

    </div>  
      
    <div class="center">
      <input class="playButton btn btn-primary disabled" type="submit" value="JOUER" />
      </form>        
    </div>

    {% else %}
      <p>Il n'y a encore aucun joueur.</p>
      <a href=" {{ path('add_gamer') }} "><button class="btn btn-primary" type="button">Ajoutez en un !</button></a>
    {% endif %}

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript">
    $(function () {
      
        var limitCheckedBox = 4;
        var nbSubjectChecked;
        $('input:checkbox[name="subject[]"]').on('change', function(e) {
            nbSubjectChecked = $('.chooseSubject input:checked').length;
            if(nbSubjectChecked > limitCheckedBox) {
              this.checked = false;
            }
        });

        $('input:checkbox').on('change', function(e) {
            var nbGamerChecked = $('.gamer input:checked').length;
            nbSubjectChecked = $('.chooseSubject input:checked').length;
            
            if(nbSubjectChecked >= limitCheckedBox && nbGamerChecked >= 1) {
              $('.playButton').removeClass('disabled');
            } else {
              $('.playButton').addClass('disabled');              
            }
        });        

        $('.checkAllGamers').on('click', function(e) {
          e.preventDefault();
          $('.gamer input:checkbox').each(function(){
              this.checked = true;
          });
          if ($('.chooseSubject input:checked').length == limitCheckedBox) {
            $('.playButton').removeClass('disabled');
          }          
        });

        $('.checkAllSubjects').on('click', function(e) {
          e.preventDefault();
          $('.chooseSubject input:checkbox').each(function(i){
              this.checked = true;
              if ($('.gamer input:checked').length >= 1) {
                $('.playButton').removeClass('disabled');            
              }
              if ($('.chooseSubject input:checked').length != limitCheckedBox) {
                $('.playButton').addClass('disabled');
              }          
              if (i == 3) {
                return false;
              }
          });
        });

    });
    </script>

{% endblock %}
 